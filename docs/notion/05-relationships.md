# 관계 설정 방법

## 개요

노션에서 관계를 설정하는 방법은 Supabase와 다릅니다. 이 문서에서는 일대다, 다대다 관계를 설정하는 방법을 설명합니다.

## 1. 일대다 관계 설정

### 예시: 훈련과정 → 능력단위

#### 단계별 가이드

1. **능력단위** 데이터베이스에서:

   - 속성 추가 버튼 클릭
   - 속성 유형: **Relation** 선택
   - 속성 이름: `훈련과정` 입력
   - 연결 대상: `훈련과정` 데이터베이스 선택
   - 관계 유형: **양방향** (Two-way) 선택
   - 저장

2. **훈련과정** 데이터베이스에서 (양방향인 경우):
   - 자동으로 `능력단위` 관계 속성이 생성됨
   - 확인 및 속성 이름 조정 (필요시)

### 주의사항

- 관계를 설정하기 전에 **모든 관련 데이터베이스를 먼저 생성**해야 합니다
- 양방향 관계는 자동으로 반대쪽 속성이 생성되므로, 단방향 관계가 필요한 경우에만 단일 속성 선택

---

## 2. 다대다 관계 설정

### 예시: 훈련과정 ↔ 교사 (course_teachers)

다대다 관계는 두 가지 방법으로 구현할 수 있습니다.

### 방법 1: 중간 데이터베이스 사용 (권장)

추가 정보(생성일 등)를 저장할 수 있어 권장합니다.

#### 단계별 가이드

**1단계: 중간 데이터베이스 생성**

`훈련과정-교사` 데이터베이스를 생성합니다:

- `훈련과정` (Relation → 훈련과정)
- `교사` (Relation → 프로필)
- `생성일` (Created time)

**2단계: 훈련과정 데이터베이스 설정**

- `담당 교사` (Relation → 훈련과정-교사) 속성 추가
- `담당 교사` 롤업 속성 추가:
  - 관계: `담당 교사`
  - 함수: Unique values
  - 속성: `교사`

**3단계: 프로필 데이터베이스 설정**

- `담당 훈련과정` (Relation → 훈련과정-교사) 속성 추가
- `담당 훈련과정` 롤업 속성 추가:
  - 관계: `담당 훈련과정`
  - 함수: Unique values
  - 속성: `훈련과정`

### 방법 2: 양방향 관계 사용

간단하지만 추가 정보 저장이 불가능합니다.

#### 단계별 가이드

**1단계: 훈련과정 데이터베이스 설정**

- `담당 교사` (Relation → 프로필, 양방향) 속성 추가

**2단계: 프로필 데이터베이스 확인**

- 자동으로 `담당 훈련과정` 속성이 생성됨

### 방법 비교

| 항목           | 방법 1 (중간 DB) | 방법 2 (양방향) |
| -------------- | ---------------- | --------------- |
| 추가 정보 저장 | ✅ 가능          | ❌ 불가능       |
| 복잡도         | 높음             | 낮음            |
| 유지보수       | 어려움           | 쉬움            |
| 권장 여부      | ✅ 권장          | 간단한 경우만   |

---

## 3. 관계형 속성 생성 순서

### 중요 원칙

관계를 설정하기 전에 **모든 관련 데이터베이스를 먼저 생성**해야 합니다.

### 권장 순서

1. **기본 데이터베이스 생성**

   - 프로필
   - 훈련과정
   - 능력단위
   - 능력단위요소
   - 수행준거

2. **관계 테이블 생성**

   - 훈련과정-교사
   - 훈련과정-학생

3. **관계형 속성 추가**

   - 일대다 관계 설정
   - 다대다 관계 설정

4. **롤업 속성 추가**

   - 관계가 설정된 후에만 가능

5. **수식 속성 추가**
   - 롤업이 설정된 후에 가능

---

## 4. 실제 예시: 전체 관계 설정

### 예시 1: 훈련과정 → 능력단위 (일대다)

```
1. 능력단위 데이터베이스 열기
2. 속성 추가 → Relation
3. 이름: "훈련과정"
4. 연결: 훈련과정 데이터베이스
5. 양방향 선택
6. 저장
```

### 예시 2: 훈련과정 ↔ 교사 (다대다)

```
1. 훈련과정-교사 데이터베이스 생성
   - 훈련과정 (Relation)
   - 교사 (Relation)
   - 생성일 (Created time)

2. 훈련과정 데이터베이스
   - 담당 교사 (Relation → 훈련과정-교사)
   - 담당 교사 목록 (Rollup → Unique values)

3. 프로필 데이터베이스
   - 담당 훈련과정 (Relation → 훈련과정-교사)
   - 담당 훈련과정 목록 (Rollup → Unique values)
```

### 예시 3: 평가 → 평가 점수 상세 (일대다)

```
1. 평가 점수 상세 데이터베이스 열기
2. 속성 추가 → Relation
3. 이름: "평가"
4. 연결: 평가 데이터베이스
5. 양방향 선택
6. 저장

7. 평가 데이터베이스에서
   - 평가 점수 상세 (Relation) 자동 생성 확인
   - 원점수 합계 (Rollup → Sum) 추가
```

---

## 5. 문제 해결

### 문제 1: 관계 속성이 보이지 않음

**원인**: 데이터베이스가 아직 생성되지 않음

**해결**: 먼저 연결할 데이터베이스를 생성한 후 관계 설정

### 문제 2: 롤업 속성이 작동하지 않음

**원인**: 관계가 설정되지 않았거나 롤업 설정이 잘못됨

**해결**:

1. 관계 속성이 올바르게 설정되었는지 확인
2. 롤업 속성의 함수와 속성 선택 확인

### 문제 3: 순환 참조 오류

**원인**: 양방향 관계 설정 시 순환 참조 발생

**해결**: 단방향 관계로 변경하거나 중간 데이터베이스 사용

---

## 6. 모범 사례

### 1. 명명 규칙

- 관계 속성은 명확하고 간결하게
- 롤업 속성은 "~ 수", "~ 합계", "~ 목록" 등으로 명명

### 2. 성능 최적화

- 불필요한 양방향 관계는 피하기
- 자주 사용하는 롤업만 추가

### 3. 데이터 무결성

- 관계 설정 후 데이터 연결 확인
- 롤업 속성 값 검증

---

## 다음 단계

이제 다음 문서를 읽어보세요:

1. **[롤업 및 수식 속성 활용](./06-rollups-formulas.md)** - 계산 필드 추가 방법
2. **[데이터베이스 생성 순서](./08-creation-order.md)** - 단계별 생성 가이드

---

**이전**: [테이블별 노션 데이터베이스 설계](./04-database-designs.md)  
**다음**: [롤업 및 수식 속성 활용](./06-rollups-formulas.md)
