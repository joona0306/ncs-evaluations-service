# 롤업 및 수식 속성 활용

## 개요

노션의 롤업(Rollup)과 수식(Formula) 속성을 활용하면 관계된 데이터를 자동으로 계산하고 집계할 수 있습니다. 이 문서에서는 다양한 활용 예시를 제공합니다.

## 롤업 속성 활용

### 1. 개수 집계 (Count)

관계된 레코드의 개수를 계산합니다.

#### 예시: 훈련과정 → 학생 수

**설정 방법**:
1. 훈련과정 데이터베이스 열기
2. 속성 추가 → Rollup
3. 이름: `학생 수`
4. 관계: `수강 학생` (Relation → course_students)
5. 함수: **Count**
6. 속성: 모든 속성
7. 저장

**결과**: 해당 훈련과정에 수강하는 학생 수가 자동으로 계산됩니다.

#### 다른 예시
- 평가일정 → 제출 수 (제출된 과제물 수)
- 능력단위 → 평가 수 (관련 평가 수)
- 평가 → 서명 수 (서명 수)

---

### 2. 합계 계산 (Sum)

관계된 숫자 속성의 합을 계산합니다.

#### 예시: 평가 → 원점수 합계

**설정 방법**:
1. 평가 데이터베이스 열기
2. 속성 추가 → Rollup
3. 이름: `원점수 합계`
4. 관계: `평가 점수 상세` (Relation → evaluation_criteria_scores)
5. 함수: **Sum**
6. 속성: `점수` (Number)
7. 저장

**결과**: 모든 수행준거의 점수 합계가 자동으로 계산됩니다.

#### 다른 예시
- 능력단위요소 → 최대 점수 합계 (모든 수행준거의 최대 점수 합)

---

### 3. 평균 계산 (Average)

관계된 숫자 속성의 평균을 계산합니다.

#### 예시: 능력단위 → 평균 평가 점수

**설정 방법**:
1. 능력단위 데이터베이스 열기
2. 속성 추가 → Rollup
3. 이름: `평균 점수`
4. 관계: `평가` (Relation → evaluations)
5. 함수: **Average**
6. 속성: `총점 (백분율)` (Formula)
7. 저장

**결과**: 해당 능력단위의 평균 평가 점수가 자동으로 계산됩니다.

---

### 4. 고유값 추출 (Unique values)

관계된 속성의 고유값 목록을 추출합니다.

#### 예시: 훈련과정 → 담당 교사 목록

**설정 방법**:
1. 훈련과정 데이터베이스 열기
2. 속성 추가 → Rollup
3. 이름: `담당 교사 목록`
4. 관계: `담당 교사` (Relation → course_teachers)
5. 함수: **Unique values**
6. 속성: `교사` (Relation)
7. 저장

**결과**: 중복 없이 담당 교사 목록이 표시됩니다.

---

### 5. 최소값/최대값 (Min/Max)

관계된 숫자 속성의 최소값 또는 최대값을 계산합니다.

#### 예시: 능력단위 → 최고 평가 점수

**설정 방법**:
1. 능력단위 데이터베이스 열기
2. 속성 추가 → Rollup
3. 이름: `최고 점수`
4. 관계: `평가` (Relation → evaluations)
5. 함수: **Max**
6. 속성: `총점 (백분율)` (Formula)
7. 저장

---

## 수식 속성 활용

### 1. 조건부 표시

조건에 따라 다른 값을 표시합니다.

#### 예시: 과제물 제출 → 이름

**수식**:
```
if(prop("제출 유형") == "image", prop("파일명"), prop("링크 URL"))
```

**설정 방법**:
1. 과제물 제출 데이터베이스 열기
2. "이름" 속성 편집 (Title은 수식 불가, 별도 Formula 속성 생성)
3. 또는 별도 Formula 속성 생성: `제목`
4. 수식 입력

**결과**: 제출 유형이 "image"이면 파일명, "url"이면 링크 URL이 표시됩니다.

---

### 2. 날짜 계산

날짜 간의 차이를 계산합니다.

#### 예시: 훈련과정 → 기간

**수식**:
```
dateBetween(prop("종료일"), prop("시작일"), "days")
```

**설정 방법**:
1. 훈련과정 데이터베이스 열기
2. 속성 추가 → Formula
3. 이름: `기간`
4. 수식 입력
5. 저장

**결과**: 시작일과 종료일 사이의 일수가 자동으로 계산됩니다.

#### 다른 예시
- 평가일정 → 기간 (평가 기간 일수)

---

### 3. 백분율 계산

비율을 계산합니다.

#### 예시: 평가 → 총점 (백분율)

**수식**:
```
if(prop("최대 점수 합계") > 0, round((prop("원점수 합계") / prop("최대 점수 합계")) * 100, 2), 0)
```

**설정 방법**:
1. 평가 데이터베이스 열기
2. 속성 추가 → Formula
3. 이름: `총점 (백분율)`
4. 수식 입력
5. 저장

**결과**: 원점수 합계를 최대 점수 합계로 나눈 백분율이 계산됩니다.

**주의**: 
- `if` 함수로 0으로 나누기 방지
- `round` 함수로 소수점 둘째 자리까지 반올림

#### 다른 예시
- 평가 점수 상세 → 점수 비율 (점수 / 최대 점수 * 100)

---

### 4. 문자열 결합

여러 속성을 결합하여 표시합니다.

#### 예시: 평가 → 이름

**수식**:
```
prop("능력단위명") + " - " + prop("학생명")
```

**설정 방법**:
1. 평가 데이터베이스 열기
2. "이름" 속성은 Title이므로 수식 불가
3. 별도 Formula 속성 생성: `제목` 또는 `표시명`
4. 수식 입력

**결과**: "능력단위명 - 학생명" 형식으로 표시됩니다.

#### 다른 예시
- 평가 점수 상세 → 이름: `prop("평가명") + " - " + prop("준거명")`
- 서명 → 이름: `prop("평가명") + " - " + prop("서명자명")`

---

### 5. 조건부 색상 표시

수식으로 계산된 값을 기반으로 색상을 표시합니다.

#### 예시: 평가 → 점수 등급

**수식**:
```
if(prop("총점 (백분율)") >= 90, "A", if(prop("총점 (백분율)") >= 80, "B", if(prop("총점 (백분율)") >= 70, "C", "D")))
```

**설정 방법**:
1. 평가 데이터베이스 열기
2. 속성 추가 → Formula
3. 이름: `점수 등급`
4. 수식 입력
5. 저장

**결과**: 점수에 따라 A, B, C, D 등급이 자동으로 표시됩니다.

---

## 고급 수식 예시

### 1. 날짜 포맷팅

```
formatDate(prop("시작일"), "YYYY년 MM월 DD일")
```

### 2. 숫자 포맷팅

```
format(prop("총점 (백분율)") / 100, "percent")
```

### 3. 복잡한 조건문

```
if(and(prop("상태") == "confirmed", prop("총점 (백분율)") >= 70), "합격", "불합격")
```

### 4. 배열 처리

```
join(prop("태그"), ", ")
```

---

## 문제 해결

### 문제 1: 롤업 속성이 0으로 표시됨

**원인**: 관계가 설정되지 않았거나 롤업 설정이 잘못됨

**해결**:
1. 관계 속성이 올바르게 설정되었는지 확인
2. 롤업 속성의 함수와 속성 선택 확인
3. 관계된 레코드가 실제로 연결되어 있는지 확인

### 문제 2: 수식 속성이 오류 표시

**원인**: 수식 구문 오류 또는 속성 이름 오타

**해결**:
1. 수식 구문 확인 (괄호, 따옴표 등)
2. 속성 이름이 정확한지 확인 (대소문자 구분)
3. 속성 유형이 수식에서 사용 가능한지 확인

### 문제 3: 롤업 속성이 업데이트되지 않음

**원인**: 관계된 데이터가 변경되었지만 롤업이 갱신되지 않음

**해결**:
1. 페이지 새로고침
2. 롤업 속성 재설정
3. 관계 확인

---

## 모범 사례

### 1. 성능 최적화

- 필요한 롤업만 추가 (과도한 롤업은 성능 저하)
- 간단한 수식 사용 (복잡한 수식은 성능 저하)

### 2. 명명 규칙

- 롤업: "~ 수", "~ 합계", "~ 평균", "~ 목록"
- 수식: 계산 내용을 명확히 표현

### 3. 문서화

- 복잡한 수식은 주석 추가 (속성 설명 활용)
- 롤업 속성의 목적 명시

---

## 다음 단계

이제 다음 문서를 읽어보세요:

1. **[데이터베이스 생성 순서](./08-creation-order.md)** - 단계별 생성 가이드
2. **[Supabase 단점 보완 방안](./07-supabase-improvements.md)** - 노션의 장점 활용

---

**이전**: [관계 설정 방법](./05-relationships.md)  
**다음**: [Supabase 단점 보완 방안](./07-supabase-improvements.md)

