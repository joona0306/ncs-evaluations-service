# 문제 해결 및 트러블슈팅

## 개요

이 문서는 노션 데이터베이스 구현 및 마이그레이션 과정에서 발생할 수 있는 문제와 해결 방법을 제공합니다.

## 일반적인 문제

### 1. 관계 속성이 보이지 않음

**증상**: 관계를 설정했는데 속성이 표시되지 않음

**원인**:
- 연결할 데이터베이스가 아직 생성되지 않음
- 관계 설정 과정에서 오류 발생
- 권한 문제

**해결 방법**:
1. 연결할 데이터베이스가 생성되었는지 확인
2. 관계 속성을 다시 설정
3. 페이지 새로고침
4. 권한 확인 (데이터베이스 접근 권한)

---

### 2. 롤업 속성이 0으로 표시됨

**증상**: 롤업 속성이 항상 0으로 표시됨

**원인**:
- 관계가 설정되지 않았음
- 롤업 설정이 잘못됨
- 관계된 레코드가 실제로 연결되지 않음

**해결 방법**:
1. 관계 속성이 올바르게 설정되었는지 확인
2. 롤업 속성의 함수와 속성 선택 확인:
   - Count: 모든 속성 선택
   - Sum/Average: Number 속성 선택
   - Unique values: Relation 속성 선택
3. 실제로 관계된 레코드가 연결되어 있는지 확인
4. 롤업 속성 재설정

**예시 확인**:
- 훈련과정 → 학생 수가 0인 경우:
  1. 훈련과정 데이터베이스에서 "수강 학생" 관계 확인
  2. 훈련과정-학생 데이터베이스에 레코드가 있는지 확인
  3. 롤업 속성 설정 확인 (함수: Count)

---

### 3. 수식 속성이 오류 표시

**증상**: 수식 속성에 오류 메시지 표시

**원인**:
- 수식 구문 오류
- 속성 이름 오타
- 속성 유형 불일치

**해결 방법**:

#### 구문 오류 확인

**예시 1: 괄호 불일치**
```
# 잘못된 예시
if(prop("상태") == "confirmed", prop("총점") * 100

# 올바른 예시
if(prop("상태") == "confirmed", prop("총점") * 100, 0)
```

**예시 2: 따옴표 사용**
```
# 잘못된 예시
prop("능력단위명") + " - " + prop("학생명")

# 올바른 예시 (노션은 자동으로 처리)
prop("능력단위명") + " - " + prop("학생명")
```

#### 속성 이름 확인

- 속성 이름이 정확한지 확인 (대소문자 구분 없음)
- 속성이 존재하는지 확인
- 속성 유형이 수식에서 사용 가능한지 확인

#### 속성 유형 불일치

**예시: 날짜 계산**
```
# 잘못된 예시 (Text 속성 사용)
dateBetween(prop("종료일"), prop("시작일"), "days")

# 올바른 예시 (Date 속성 사용)
dateBetween(prop("종료일"), prop("시작일"), "days")
```

---

### 4. 순환 참조 오류

**증상**: 관계 설정 시 순환 참조 오류 발생

**원인**: 양방향 관계 설정 시 순환 참조 발생

**해결 방법**:
1. 단방향 관계로 변경
2. 중간 데이터베이스 사용
3. 관계 구조 재설계

**예시**:
- A → B (양방향)
- B → C (양방향)
- C → A (양방향) ← 순환 참조 발생

**해결**: 하나를 단방향으로 변경

---

### 5. 데이터 임포트 실패

**증상**: CSV 임포트 시 오류 발생

**원인**:
- 파일 형식 오류
- 인코딩 문제
- 데이터 형식 불일치
- 필드 수 불일치

**해결 방법**:

#### 파일 형식 확인

1. CSV 파일이 UTF-8 인코딩인지 확인
2. 구분자가 쉼표(,)인지 확인
3. 특수 문자가 올바르게 이스케이프되었는지 확인

#### 데이터 형식 확인

1. 날짜 형식: `YYYY-MM-DD` 또는 `YYYY-MM-DD HH:MM:SS`
2. 숫자 형식: 소수점은 마침표(.) 사용
3. 불리언 값: `true`, `false` 또는 `1`, `0`

#### 필드 수 확인

- CSV 헤더와 데이터 행의 필드 수가 일치하는지 확인
- 빈 필드는 빈 문자열로 처리

---

### 6. 관계 연결 실패

**증상**: 레코드 간 관계를 연결할 수 없음

**원인**:
- 레코드 이름이 일치하지 않음
- 관계 속성이 설정되지 않음
- 권한 문제

**해결 방법**:

#### 레코드 이름 확인

1. 연결할 레코드의 "이름" 속성 확인
2. 정확한 이름으로 검색
3. 대소문자 구분 확인

#### 관계 속성 확인

1. 관계 속성이 올바르게 설정되었는지 확인
2. 양방향 관계인 경우 반대쪽 속성도 확인

#### 수동 연결

1. 레코드 열기
2. 관계 속성 클릭
3. 검색하여 연결할 레코드 선택

---

### 7. 롤업 속성이 업데이트되지 않음

**증상**: 관계된 데이터를 변경했는데 롤업 속성이 갱신되지 않음

**원인**:
- 캐시 문제
- 롤업 설정 오류
- 관계 문제

**해결 방법**:
1. 페이지 새로고침
2. 롤업 속성 재설정
3. 관계 확인
4. 노션 앱 재시작 (필요시)

---

### 8. 수식 속성이 계산되지 않음

**증상**: 수식 속성이 빈 값으로 표시됨

**원인**:
- 수식 구문 오류
- 참조하는 속성이 없음
- 속성 유형 불일치

**해결 방법**:
1. 수식 구문 확인
2. 참조하는 속성이 존재하는지 확인
3. 속성 유형 확인
4. 수식 재입력

---

## 마이그레이션 관련 문제

### 1. UUID 매핑 문제

**증상**: Supabase의 UUID를 노션에서 사용할 수 없음

**해결 방법**:
1. UUID 대신 실제 이름이나 코드 사용
2. 관계는 나중에 수동으로 연결
3. 매핑 테이블 생성 (선택사항)

**예시 매핑 테이블**:
```
Supabase UUID → 노션 레코드 이름
550e8400-... → "홍길동"
660e8400-... → "훈련과정 A"
```

---

### 2. Enum 값 변환 문제

**증상**: Enum 값을 Select 옵션으로 변환 시 문제 발생

**해결 방법**:
1. 노션에서 Select 옵션을 먼저 생성
2. CSV 데이터를 Select 옵션과 일치하도록 변환
3. 대소문자 일치 확인

**예시**:
```
Supabase: admin, teacher, student
Notion: Admin, Teacher, Student
```

---

### 3. 날짜 형식 변환 문제

**증상**: 날짜가 올바르게 임포트되지 않음

**해결 방법**:
1. ISO 8601 형식 사용: `YYYY-MM-DD` 또는 `YYYY-MM-DD HH:MM:SS`
2. 시간대 정보 제거 (노션은 자동으로 처리)
3. 날짜 형식 확인

**예시**:
```
Supabase: 2024-01-15 10:30:00+00
Notion: 2024-01-15 10:30:00
```

---

### 4. JSONB 필드 처리 문제

**증상**: JSONB 필드를 노션에서 처리하기 어려움

**해결 방법**:

#### 방법 1: Text 속성으로 변환
- JSON을 문자열로 변환
- 필요시 레코드 페이지에 상세 정보 작성

#### 방법 2: 별도 속성으로 분리
- JSON 구조를 분석하여 개별 속성으로 분리
- 예: `evaluation_criteria` → 평가 항목1, 평가 항목2 등

#### 방법 3: 레코드 페이지 활용
- 레코드를 페이지로 열어 상세 정보 작성
- 구조화된 블록으로 정보 정리

---

## 성능 관련 문제

### 1. 데이터베이스가 느림

**증상**: 데이터베이스 로딩이 느리거나 작업이 지연됨

**원인**:
- 대량의 데이터
- 과도한 롤업 속성
- 복잡한 수식 속성
- 불필요한 관계

**해결 방법**:

#### 필터 활용
- 필요한 데이터만 표시하도록 필터 설정
- 페이지 크기 제한

#### 속성 최적화
- 불필요한 속성 숨김
- 자주 사용하지 않는 롤업 제거
- 복잡한 수식 단순화

#### 관계 최적화
- 불필요한 양방향 관계 제거
- 자주 사용하는 관계만 유지

---

### 2. 롤업 속성 계산이 느림

**증상**: 롤업 속성이 계산되는 데 시간이 오래 걸림

**원인**:
- 관계된 데이터가 많음
- 복잡한 롤업 설정

**해결 방법**:
1. 필터를 사용하여 관계된 데이터 제한
2. 필요한 롤업만 유지
3. 캐시 활용 (페이지 새로고침)

---

## 권한 관련 문제

### 1. 데이터베이스 접근 불가

**증상**: 데이터베이스에 접근할 수 없음

**원인**: 권한 설정 문제

**해결 방법**:
1. 페이지/데이터베이스 공유 설정 확인
2. 권한 레벨 확인 (전체 액세스, 편집 가능, 뷰만 가능)
3. 워크스페이스 권한 확인

---

### 2. 관계 연결 권한 문제

**증상**: 관계를 연결할 수 없음

**원인**: 연결할 데이터베이스에 대한 권한 부족

**해결 방법**:
1. 연결할 데이터베이스의 권한 확인
2. 필요한 권한 요청
3. 관리자에게 문의

---

## 데이터 무결성 문제

### 1. 중복 레코드

**증상**: 동일한 레코드가 중복으로 생성됨

**해결 방법**:
1. 중복 레코드 확인 및 삭제
2. 템플릿 사용으로 일관된 데이터 입력
3. 검증 프로세스 추가

---

### 2. 관계 불일치

**증상**: 관계가 올바르게 연결되지 않음

**해결 방법**:
1. 관계 설정 확인
2. 레코드 이름 일치 확인
3. 관계 재설정

---

## 추가 리소스

### 노션 공식 문서

- [노션 가이드](https://www.notion.so/help)
- [노션 커뮤니티](https://www.notion.so/community)

### 도움 요청

문제가 해결되지 않으면:
1. 노션 커뮤니티에 질문
2. 노션 지원팀에 문의
3. 프로젝트 팀에 문의

---

## 다음 단계

이제 다음 문서를 읽어보세요:

1. **[추가 팁 및 모범 사례](./11-best-practices.md)** - 최적화 방법
2. **[데이터 마이그레이션 가이드](./09-migration-guide.md)** - 마이그레이션 재시도

---

**이전**: [추가 팁 및 모범 사례](./11-best-practices.md)  
**다음**: [README](./README.md) - 목차로 돌아가기

