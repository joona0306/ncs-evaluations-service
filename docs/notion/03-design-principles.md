# 노션 데이터베이스 설계 원칙

## 개요

노션 데이터베이스를 설계할 때는 Supabase의 관계형 데이터베이스와 다른 특성을 고려해야 합니다. 이 문서에서는 노션 데이터베이스 설계의 핵심 원칙을 설명합니다.

## 1. 기본 속성 "이름" 활용

### 원칙

모든 노션 데이터베이스의 기본 속성인 "이름"은 변경하거나 삭제할 수 없습니다. 따라서 가장 중요한 식별 정보로 사용해야 합니다.

### 적용 방법

- **프로필**: "이름" = `full_name` (사용자 이름)
- **훈련과정**: "이름" = `name` (훈련과정명)
- **능력단위**: "이름" = `name` (능력단위명)
- **평가**: "이름" = 수식으로 자동 생성 (예: "능력단위명 - 학생명")

### 예시

```
평가 데이터베이스의 "이름" 속성:
prop("능력단위명") + " - " + prop("학생명")
```

## 2. 관계형 속성 사용

### 일대다 관계

부모 데이터베이스에서 자식 데이터베이스로 관계를 설정합니다.

**예시**: 훈련과정 → 능력단위
- 능력단위 데이터베이스에 `훈련과정` (Relation) 속성 추가
- 양방향 관계 설정 시 훈련과정 데이터베이스에 자동으로 `능력단위` 속성 생성

### 다대다 관계

두 가지 방법이 있습니다:

#### 방법 1: 중간 데이터베이스 사용 (권장)

추가 정보(생성일 등)를 저장할 수 있습니다.

**예시**: 훈련과정 ↔ 교사
1. `훈련과정-교사` 데이터베이스 생성
2. `훈련과정` (Relation) 속성
3. `교사` (Relation) 속성
4. `생성일` (Created time) 속성

#### 방법 2: 양방향 관계 사용

간단하지만 추가 정보 저장 불가.

**예시**: 훈련과정 ↔ 교사
1. 훈련과정 데이터베이스에 `담당 교사` (Relation, 양방향) 추가
2. 프로필 데이터베이스에 자동으로 `담당 훈련과정` 속성 생성

## 3. 롤업 속성 활용

### 개수 집계 (Count)

관계된 레코드의 개수를 계산합니다.

**예시**: 훈련과정 → 학생 수
- 관계: `수강 학생` (Relation → course_students)
- 롤업: `학생 수`
- 함수: Count
- 속성: 모든 속성

### 합계 계산 (Sum)

관계된 숫자 속성의 합을 계산합니다.

**예시**: 평가 → 원점수 합계
- 관계: `평가 점수 상세` (Relation → evaluation_criteria_scores)
- 롤업: `원점수 합계`
- 함수: Sum
- 속성: `점수` (Number)

### 평균 계산 (Average)

관계된 숫자 속성의 평균을 계산합니다.

**예시**: 능력단위 → 평균 평가 점수
- 관계: `평가` (Relation → evaluations)
- 롤업: `평균 점수`
- 함수: Average
- 속성: `총점 (백분율)` (Formula)

### 고유값 추출 (Unique values)

관계된 속성의 고유값 목록을 추출합니다.

**예시**: 훈련과정 → 담당 교사 목록
- 관계: `담당 교사` (Relation → course_teachers)
- 롤업: `담당 교사 목록`
- 함수: Unique values
- 속성: `교사` (Relation)

## 4. 수식 속성 활용

### 조건부 표시

조건에 따라 다른 값을 표시합니다.

**예시**: 과제물 제출 → 이름
```
if(prop("제출 유형") == "image", prop("파일명"), prop("링크 URL"))
```

### 날짜 계산

날짜 간의 차이를 계산합니다.

**예시**: 훈련과정 → 기간
```
dateBetween(prop("종료일"), prop("시작일"), "days")
```

### 백분율 계산

비율을 계산합니다.

**예시**: 평가 → 총점 (백분율)
```
if(prop("최대 점수 합계") > 0, round((prop("원점수 합계") / prop("최대 점수 합계")) * 100, 2), 0)
```

### 문자열 결합

여러 속성을 결합하여 표시합니다.

**예시**: 평가 → 이름
```
prop("능력단위명") + " - " + prop("학생명")
```

## 5. Select/Multi-select 활용

### Enum 타입 변환

Supabase의 Enum 타입을 노션의 Select 속성으로 변환합니다.

**예시**:
- `user_role` (admin, teacher, student) → Select 속성
- `enrollment_status` (active, completed, withdrawn) → Select 속성
- `evaluation_status` (draft, submitted, confirmed) → Select 속성

### 옵션 색상 설정

각 옵션에 의미 있는 색상을 지정합니다.

**예시**: 역할 (user_role)
- Admin (빨간색) - 관리자
- Teacher (노란색) - 교사
- Student (초록색) - 학생

## 6. 속성 생성 순서

중요: 관계를 설정하기 전에 모든 관련 데이터베이스를 먼저 생성해야 합니다.

### 권장 순서

1. **기본 데이터베이스 생성** (프로필, 훈련과정 등)
2. **관계형 속성 추가** (일대다, 다대다)
3. **롤업 속성 추가** (관계가 설정된 후)
4. **수식 속성 추가** (롤업이 설정된 후)

## 7. 속성 명명 규칙

### 일관성 유지

- 한글 사용 권장 (노션 사용자 친화적)
- 명확하고 간결한 이름
- 롤업 속성은 "~ 수", "~ 합계", "~ 평균" 등으로 명명

### 예시

- `학생 수` (Rollup, Count)
- `원점수 합계` (Rollup, Sum)
- `평균 점수` (Rollup, Average)
- `총점 (백분율)` (Formula)

## 8. 데이터 타입 선택 가이드

### Text vs Title

- **Title**: 기본 속성 "이름"에 사용, 가장 중요한 식별 정보
- **Text**: 일반 텍스트 정보

### Number vs Formula

- **Number**: 직접 입력하는 숫자
- **Formula**: 계산된 숫자

### Date vs Created time

- **Date**: 사용자가 입력하는 날짜
- **Created time**: 자동 생성되는 생성일시
- **Last edited time**: 자동 생성되는 수정일시

### Relation vs Rollup

- **Relation**: 다른 데이터베이스와의 연결
- **Rollup**: 관계된 데이터의 집계 계산

## 다음 단계

이제 다음 문서를 읽어보세요:

1. **[테이블별 노션 데이터베이스 설계](./04-database-designs.md)** - 각 테이블의 상세 설계 확인
2. **[관계 설정 방법](./05-relationships.md)** - 관계 설정 실습

---

**이전**: [Supabase 테이블 구조 분석](./02-supabase-analysis.md)  
**다음**: [테이블별 노션 데이터베이스 설계](./04-database-designs.md)

